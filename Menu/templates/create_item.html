{% extends 'base.html' %}

{% block title %}Create Menu Item{% endblock %}

{% block content %}
<div class="min-h-screen bg-gray-100 py-6 flex flex-col justify-center sm:py-12">
    <div class="relative py-3 sm:max-w-4xl sm:mx-auto">
        <div class="relative px-4 py-10 bg-white mx-8 md:mx-0 shadow-xl rounded-xl sm:p-10 border border-gray-200">
            <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                <!-- Left column - Form -->
                <div>
                    <div class="flex items-center space-x-5">
                        <div
                            class="h-14 w-14 bg-yellow-500 rounded-full flex flex-shrink-0 justify-center items-center text-white text-2xl font-mono">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8" fill="none" viewBox="0 0 24 24"
                                stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M12 6v6m0 0v6m0-6h6m-6 0H6" />
                            </svg>
                        </div>
                        <div class="block pl-2 font-semibold text-xl self-start text-gray-700">
                            <h2 class="leading-relaxed">Add New Menu Item</h2>
                            <p class="text-sm text-gray-500 font-normal leading-relaxed">Enter the details of the new
                                item
                            </p>
                        </div>
                    </div>
                    <form method="POST" enctype="multipart/form-data" action="" class="divide-y divide-gray-200">
                        {% csrf_token %}
                        <div class="py-8 text-base leading-6 space-y-4 text-gray-700 sm:text-lg sm:leading-7">
                            <div class="flex flex-col">
                                <label for="name" class="leading-loose text-left">Item Name</label>
                                <input type="text" name="name" id="name" required
                                    class="form-input w-full p-2 border border-gray-300 rounded-md focus:outline-none">
                            </div>

                            <div class="flex flex-col">
                                <label for="price" class="leading-loose text-left">Price</label>
                                <input type="number" name="price" id="price" step="0.01" required
                                    class="form-input w-full p-2 border border-gray-300 rounded-md focus:outline-none">
                            </div>

                            <div class="flex flex-col">
                                <label for="quantity" class="leading-loose text-left">Quantity</label>
                                <input type="number" name="quantity" id="quantity" required
                                    class="form-input w-full p-2 border border-gray-300 rounded-md focus:outline-none">
                            </div>

                            <div class="flex flex-col">
                                <label for="category" class="leading-loose text-left">Category</label>
                                <input type="text" name="category" id="category"
                                    class="form-input w-full p-2 border border-gray-300 rounded-md focus:outline-none">
                            </div>

                            <div class="flex flex-col">
                                <label for="itemtype" class="leading-loose text-left">Item Type</label>
                                <input type="text" name="itemtype" id="itemtype"
                                    class="form-input w-full p-2 border border-gray-300 rounded-md focus:outline-none">
                            </div>

                            <div class="flex flex-col">
                                <label for="image" class="leading-loose text-left">Image</label>
                                <input type="file" name="image" id="image" accept="image/*"
                                    class="form-input w-full p-2 border border-gray-300 rounded-md focus:outline-none"
                                    onchange="previewImage(this)">
                            </div>

                            <div class="flex flex-col">
                                <label for="availablity" class="leading-loose text-left">Availability</label>
                                <select name="availablity" id="availablity"
                                    class="form-input w-full p-2 border border-gray-300 rounded-md focus:outline-none">
                                    <option value="True">Available</option>
                                    <option value="False">Unavailable</option>
                                </select>
                            </div>

                            <div class="flex flex-col">
                                <label for="tag-input" class="leading-loose text-left">Tags</label>
                                <div class="tags-container mb-2">
                                    <div id="tags-area" class="flex flex-wrap gap-2 mb-2"></div>
                                    <div class="flex">
                                        <input type="text" id="tag-input" placeholder="Add a tag and press Enter"
                                            class="form-input w-full p-2 border border-gray-300 rounded-md focus:outline-none">
                                        <button type="button" onclick="addTag()"
                                            class="ml-2 submit_button text-white px-3 py-2 rounded-lg">Add</button>
                                    </div>
                                </div>
                                <!-- Hidden input to store tags for form submission -->
                                <input type="hidden" name="tags" id="tags">
                                <div class="tag-suggestions mt-2">
                                    <span onclick="selectTag('New')"
                                        class="cursor-pointer inline-block bg-gray-200 hover:bg-gray-300 rounded-full px-3 py-1 text-sm font-semibold text-gray-700 mr-2 mb-2">New</span>
                                    <span onclick="selectTag('Sale')"
                                        class="cursor-pointer inline-block bg-gray-200 hover:bg-gray-300 rounded-full px-3 py-1 text-sm font-semibold text-gray-700 mr-2 mb-2">Sale</span>
                                    <span onclick="selectTag('Popular')"
                                        class="cursor-pointer inline-block bg-gray-200 hover:bg-gray-300 rounded-full px-3 py-1 text-sm font-semibold text-gray-700 mr-2 mb-2">Popular</span>
                                    <span onclick="selectTag('Limited')"
                                        class="cursor-pointer inline-block bg-gray-200 hover:bg-gray-300 rounded-full px-3 py-1 text-sm font-semibold text-gray-700 mr-2 mb-2">Limited</span>
                                </div>
                            </div>
                        </div>
                        <div class="pt-4 flex items-center space-x-4">
                            <button type="submit" class="submit_button w-full text-white p-2 rounded-lg">
                                Add Item
                            </button>
                        </div>
                    </form>
                </div>

                <!-- Right column - Image preview -->
                <div class="flex flex-col justify-center items-center bg-gray-50 p-4 rounded-lg border border-gray-200">
                    <h3 class="text-2xl font-semibold mb-6">Image Preview</h3>
                    <div id="image-preview-container"
                        class="flex items-center justify-center h-64 w-full border-2 border-dashed border-gray-300 rounded-lg">
                        <div id="no-image-message" class="text-gray-400 text-center">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-16 w-16 mx-auto mb-2" fill="none"
                                viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z" />
                            </svg>
                            <p>No image selected</p>
                        </div>
                        <img id="image-preview" class="hidden max-h-full max-w-full object-contain" src="#"
                            alt="Preview">
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    // Handle tags
    let tags = [];

    function updateTagsDisplay() {
        const tagsArea = document.getElementById('tags-area');
        tagsArea.innerHTML = '';

        tags.forEach((tag, index) => {
            const tagElement = document.createElement('div');
            tagElement.className = 'inline-flex items-center rounded-full px-3 py-1 text-sm font-semibold text-gray-700 bg-gray-200';
            tagElement.innerHTML = `
                ${tag}
                <button type="button" onclick="removeTag(${index})" class="ml-1 focus:outline-none">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                    </svg>
                </button>
            `;
            tagsArea.appendChild(tagElement);
        });

        // Update hidden input for form submission
        document.getElementById('tags').value = JSON.stringify(tags);
    }

    function addTag() {
        const input = document.getElementById('tag-input');
        const value = input.value.trim();

        if (value && !tags.includes(value)) {
            tags.push(value);
            updateTagsDisplay();
            input.value = '';
        }

        input.focus();
    }

    function removeTag(index) {
        tags.splice(index, 1);
        updateTagsDisplay();
    }

    function selectTag(tag) {
        if (!tags.includes(tag)) {
            tags.push(tag);
            updateTagsDisplay();
        }
    }

    // Handle Enter key in tag input
    document.getElementById('tag-input').addEventListener('keydown', function (e) {
        if (e.key === 'Enter') {
            e.preventDefault();
            addTag();
        }
    });

    // Handle image preview
    function previewImage(input) {
        const preview = document.getElementById('image-preview');
        const noImageMessage = document.getElementById('no-image-message');

        if (input.files && input.files[0]) {
            const reader = new FileReader();

            reader.onload = function (e) {
                preview.src = e.target.result;
                preview.classList.remove('hidden');
                noImageMessage.classList.add('hidden');
            };

            reader.readAsDataURL(input.files[0]);
        } else {
            preview.src = '#';
            preview.classList.add('hidden');
            noImageMessage.classList.remove('hidden');
        }
    }
</script>
{% endblock %}